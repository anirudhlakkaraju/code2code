{% extends 'base.html' %}

{% load widget_tweaks %}

{% block content %}

{% load static %}

    <header>
        <link rel="stylesheet"  href="{%  static  'css/translate.css'  %}">
        <h1 class="title">
            <a class="text-decoration-none" style="color: whitesmoke;" href="{% url 'home'%}">CODE</a>
            <a class="text-decoration-none two-font" style="color: rgb(220, 110, 20);" href="{% url 'home'%}"> 2 </a>
            <a class="text-decoration-none" style="color: whitesmoke;" href="{% url 'home'%}">CODE</a>
        </h1>        
    </header>

    <form id="inputForm" action="" method="post">

        {% csrf_token %}
       <div class="container main-box">
           <div class="container-sm box1">
                <div class="container form-row">
                    <div class="form-group col-md-6">
                        <label for="SourceLanguageSelection" class="label-font">SOURCE LANGUAGE</label>
                        {% render_field form.source_language id="SourceLanguageSelection" class="form-control drop-font" %}
                    </div>
            
                    <div class="form-group col-md-6">
                        <label for="TargetLanguageSelection" class="label-font">TARGET LANGUAGE</label>
                        {% render_field form.target_language id="TargetLanguageSelection" class="form-control drop-font" %}
                    </div>
                </div>
               
           
                <div class="container form-row">
                    <div class="form-group col-md-6">
                        <label for="SourceCodeInput" class="label-font">SOURCE CODE</label>
                        {% render_field form.source_code type="text" class="form-control placeholder-font" id="SourceCode" oninput="update(this.value);" placeholder="Type your source code here" %}
                    </div>
                    <div class="form-group col-md-6">
                        <label for="TranslatedCode" class="label-font">TRANSLATED CODE</label>
                        {% render_field form.translated_code type="text" class="form-control placeholder-font" id="TranslatedCode" placeholder="Translation" %}
                    </div>
                </div>
            
                <div class="container box2">
                   <div class="text-center">
                       <input type="submit" class="btn btn-dark button-font button" id="translateButton" value="TRANSLATE">
                       <button type="button" class="btn btn-dark button-font button" id="clearButton" onclick="this.form.reset();">CLEAR</button>
                   </div>
                </div>

                <div class="container spinner text-center" >
                    <div class="spinner-border spinner" id="Spinner" style="width: 3.5rem; height: 3.5rem;" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                </div>
            </div>
        </div> 

        
    </form>

{% endblock %}


{% block javascript %}

<script>

    console.log("inside AJAX call");

    // Send form inputs to "/translate" url as POST request
    const url = "{% url 'translate' %}"

    const inputForm = document.getElementById("inputForm");
    var token = '{{csrf_token}}';
    var spinner = document.getElementById("Spinner")
    const translateButton = document.getElementById("translateButton")
    const clearButton = document.getElementById("clearButton")

    // Function to execute on submitting form
    inputForm.addEventListener("submit", async function(e) {

        // Override default submit action
        e.preventDefault()

        console.log("Translate button is clicked")
        
        // Dictionary to store form inputs
        let inputFormResponse = {}

        inputFormResponse["sourceLanguage"] = document.getElementById("SourceLanguageSelection").value 
        inputFormResponse["targetLanguage"] = document.getElementById("TargetLanguageSelection").value
        inputFormResponse["sourceCode"] = document.getElementById("SourceCode").value;

        console.log(inputFormResponse)

        // Show loading gif 
        spinner.style.visibility = "visible"

        // Disable translate button to prevent multiple clicks
        translateButton.setAttribute("disabled","disabled")
        clearButton.setAttribute("disabled","disabled")

        // Sending response and wait for translated text
        const resbody = await fetch(url, {
            method: "POST",
            headers: {
                "X-CSRFToken": token,
                "Content-Type": "application/json"
            },
            body: JSON.stringify(inputFormResponse)
        });
        
        const translatedCode = await resbody.json()
        // const translatedCode = resbody.json()
        console.log(translatedCode)

        document.getElementById("TranslatedCode").value = translatedCode["Response"]
        // Display translated text

        // Remove spinner
        spinner.style.visibility = "hidden"

        // Enable translate button again
        translateButton.removeAttribute("disabled")
        clearButton.removeAttribute("disabled")
    });
</script>
<!-- </script> -->
{% endblock javascript %}
